# 作業目的

「Wikipediaゴルフの攻略本をAI(LLM)で自動的に実現する手法」を解説する技術系同人誌の原稿を作成する。

このドキュメントには、どんな本にしたいかが書かれているが、本としての文体をなしていない。
リポジトリ内のデータを参照しつつ、一冊の本として成立する文章を作成する。

# 本の仕様

タイトル「AIに攻略本を作らせたい！ Wikipediaゴルフ編」
表紙・奥付は不要（別途作成）で、B5サイズ10ページの本文を作る。
短いので、目次は不要。

出力形式はMarkdownファイル1個。 `report/output/body.md` ファイルに出力する。

# 本の内容

## 大きな目的

ゲームの攻略本を、AIによって自動生成する技術を開発したい。

## 本書の目的

ゲームの一例としてWikipediaゴルフを取り上げる。Wikipediaゴルフの攻略本をLLMを用いて自動生成させ、その結果を報告する。
なぜWikipediaゴルフか？人間にわかる言葉で攻略本を出力させることが大きな目的で、そのためにはLLMを使うのが有力な手段。LLMが比較的理解しやすい、言葉を扱うゲームが適切だと考えた。LLMはオセロなどボードゲームをプレイする能力が低く、このようなゲームについては、ネットに掲載された人間が書いた攻略法を学習し、それを吐き出す以上のことができないと思われるため。
LLMとは何か、ChatGPTなどの基盤技術だということを簡潔に説明。

## 攻略本の定義
ゲームをプレイするテクニックが書かれた、人間に理解可能なテキスト。日本語かつ2000文字以下とする。囲碁で人間のトッププレイヤーを超えたAlphaGoのようなゲームAIはゲームが非常に得意だが、テクニックに相当する部分は大量の数値が並んだニューラルネットワークであり、人間には理解できない点が異なる。

## Wikipediaゴルフとは
参考文献: https://ja.wikipedia.org/wiki/Wikipedia:Wikipedia%E3%82%B4%E3%83%AB%E3%83%95
引用
> プレイヤーはWikipediaのある記事からスタートし、ゴールとなる記事になるべく少ないウィキリンクのクリック数または速い時間で移動することを目指します。記事はおまかせ表示で選ぶか、指定されたものを使います。

LLMに解かせるにあたって、次のようにルールを規定した。
- スタート・ゴールは全ページからランダムに選ばれる。ただし、ゴールは被リンク数が100以上あるページに限定する（これがないと、マイナーな人物や作品が選ばれてクリアできないことが多すぎた）
- 現在いるページに含まれるリンク（最大500件）または以前訪問したページから1つを選択して移動する。
- 移動10回以内でゴールできたら成功。

## ゲームをLLMにプレイさせる方法

ChatGPTと対話するイメージ。

ゲームシステムがスタートとゴールを決めて、対話セッションを開始する。今回は、「麻績テレビ中継局」「南勢バイパス」が選ばれた。テンプレートにこれらをあてはめて、最初にこのようなプロンプトを送る。(リンクは最大500個含まれるので、見やすくするため大幅に省略)

```
あなたはWikipediaゴルフのプレイヤーです。
基本ルール:
- スタートとゴールのWikipediaページの間をリンクだけで移動します。
- 1ターンでできることは、現在のページからリンクされたページ、または過去に訪れたページへ戻ること。
- 20ターン以内にゴールへ到達できない場合は失敗。
- 提示されるリンク数は最大500個。これ以上存在する場合はランダムに選ばれる。

攻略本:
{ここに攻略本（テキスト）が挿入される}
状況:
- ゴール: 南勢バイパス
- 現在地: 麻績テレビ中継局
- 移動履歴: 麻績テレビ中継局
- ターン: 1/10
- 選択肢(|区切り): 11月20日|12月1日|2008年|2011年|7月24日|NHK教育テレビジョン|NHK総合テレビジョン|NHK長野放送局|Portable Document Format|チャンネル (テレビ放送)|テレビ|テレビ信州|リモコンキーID|中継局|信越放送|全国放送|実効放射電力|放送|東筑摩郡|空中線電力|筑北村|聖山 (長野県)|長野市|長野放送|長野朝日放送|長野県|麻績村
- ゴール概要: 南勢バイパス（なんせいバイパス）は、三重県松阪市から伊勢市にかけて市街地を迂回する国道23号バイパス。松阪市西黒部町1交差点から伊勢市通町ICまでは国道42号と重複している。
ゴールに近づくため、次に移動するページを選択肢から1つだけ選んでください。1行目に『考察: 検討過程(100文字まで)』、2行目に『移動先: 選択肢』としてください。
```

これに対して、LLMからレスポンスが得られる。

```
考察: 「麻績テレビ中継局」は長野県にあるため、まずは長野県に関連するページへ移動するのが自然。長野県は選択肢にある。
移動先: 長野県
```

ゲームシステムがレスポンスから移動先を抽出して、今度は「長野県」のページに存在するリンクを取得し、次のプロンプトをLLMに送る。

```
状況:
- ゴール: 南勢バイパス
- 現在地: 長野県
- 移動履歴: 麻績テレビ中継局->長野県
- ターン: 2/10
- 選択肢(|区切り): 麻績テレビ中継局|10月10日|下條村|下諏訪温泉|世直し一揆|中井侍駅|中京圏|中央アルプス国定公園|中央自動車道|中央高地|中房温泉|中日ドラゴンズ
ゴールに近づくため、次に移動するページを選択肢から1つだけ選んでください。1行目に『考察: 検討過程(100文字まで)』、2行目に『移動先: 選択肢』としてください。
```

さらにLLMがレスポンスを返して、ゲームが進む。

```
考察: 長野県は広範囲なため、より具体的な地域や地理的特徴を持つページへ移動し、ゴールである三重県・伊勢市方面への繋がりを探る。
移動先: 中央高地
```

移動を繰り返し、ゴールに到達する最後の一手がこのように出力される。

```
考察: 現在地は「国道23号」であり、ゴールは「南勢バイパス」。選択肢には「南勢バイパス」そのものや、国道23号に関連するバイパス名、三重県内の地名が多く存在する。ゴールに最も近いのは「南勢バイパス」そのものである。
移動先: 南勢バイパス
```

ゲームが終了したら、LLM自身にプレイを反省させ、アップデートされた攻略本を生成させる。

```
今回のゲーム結果: 成功. スタート=麻績テレビ中継局, ゴール=南勢バイパス, 手数=6。
上記の対話履歴と移動履歴を踏まえ、攻略本をアップデートしてください。
条件:
- 日本語で2000文字以内。
- 箇条書きまたは短い段落で、観察から得た学びを一般化したテクニックとして記述する。
- スタートとゴールはプレイごとに変化する。「今回」「プレイ」「移動履歴」などの語や、スタート/ゴール/訪問ページの固有名詞を直接書かず、単体で読んでも成立する内容にする。
- 「失敗」「成功」といった語を避け、常に前向きな助言としてまとめる。
- 攻略本のみを出力し、それ以外の文章は書かない。
移動履歴:
- 1手目 麻績テレビ中継局 -> 長野県
- 2手目 長野県 -> 中央高地
- 3手目 中央高地 -> 中部地方
- 4手目 中部地方 -> 三重県
- 5手目 三重県 -> 国道23号
- 6手目 国道23号 -> 南勢バイパス
```

LLMから、攻略本の改訂版が出力され、1回のプレイが終了する。攻略本の全文は別途掲載する。

```
# Wikipediaゴルフ 攻略本 ～さらなる高みを目指すための戦略～ (改訂版)

## 1. 探索の初期段階における戦略的アプローチ

### 1.1. 始点ページの多角的分析と「ハブページ」の活用
ゲーム開始時、まずは始点ページの概要を深く理解することから始めましょう。そのページが持つ広範なテーマや、関連する主要な概念を把握することが、その後の探索の方向性を決定づけます。概要に登場するキーワードが、目標ページとどのように結びつく可能性があるかを常に意識してください。
```


## 自動的な攻略本生成

ChatGPTを手で操作してもプレイは可能だが、非常に手間がかかる。
API経由でLLMを呼び出すことで、自動的にゲームをプレイし、攻略本を改善させることができる。
最初に「Wikipediaゴルフの攻略本を作ってください」というプロンプトで初版の攻略本を作らせる。LLMはネット上のWikipediaゴルフに関する文章を学習しているので、ある程度のテキストが出てくる。ゲームをプレイして攻略本を改訂させる作業を100回繰り返す。これにより、様々なケースでうまくいく攻略本が生成されることが期待できる。

## 実験

LLMとして、GoogleのGeminiを使用した。テキスト量が多いため、最も安いモデルである"gemini2.5-flash-lite"を使用した。1日あたり1000回までなら無料で利用することも可能である。1回のプレイで10回程度の呼び出しが必要なため、無料枠ではすぐに上限に達してしまう。今回はOpenRouterという仲介サービスを用いて呼び出した。OpenRouterを使うと、OpenAIのGPT、GoogleのGemini、AnthropicのClaudeなどのモデルを統一的に呼び出せるほか、利用料の上限の設定などが簡単。

攻略本がゲームプレイを通じて改善されたことを定量的に確認する。スタートとゴールのペアをランダムに100個用意し、初版の攻略本と100回のプレイを通じて改訂した攻略本それぞれを用いて解かせた。

その結果、初版の成功率は42%なのに対して、改訂版では47%となった。有意差はないが、AIがゲームのプレイを通じて攻略本を改善したことが示唆される。

WikipediaはMediaWikiというシステムを採用している。同じシステムを採用したサイトとして、ポケモンWiki（ポケモンの情報に特化）とWikitravel（旅行に関する情報に特化）がある。これらでも同様に試した。ただ、ページ数が少ないため、ゴールとなるページの条件である被リンク数は10以上あればよいこととして緩和した。Wikipedia自体を対象としたWikipediaゴルフはテクニックがWeb上に掲載されている一方、他のWikiではその知識がそのまま使えるとは限らず、ゲームプレイを通じた経験が重要となることが期待される。

結果、ポケモンWikiでは55%→63%に改善、Wikitravelでは80%→86%に改善。いずれも有意差はないものの、期待できる数値である。

かかったコストは、300回のプレイ(攻略本改善100回、攻略本を固定した状態の評価200回)で1ドル程度。より賢いモデルは10倍程度の費用が掛かるため、実験は難しい。

## 実際の攻略本

テキストを実際に本に掲載する。

末尾が中途半端に終わっているように見えるのは、LLMが文字数制限を守らなかったために打ち切られているため。

Wikipediaの攻略本の初版 `experiments/wp-exp-20251113-4/books/0.txt`
Wikipediaの攻略本の最終版 `experiments/wp-exp-20251113-4/books/100.txt`
どちらが良いかは、ぱっと見で分からない。LLMが学習時にWikipediaゴルフのテクニックを読んでいるため、十分な情報が最初からあったかもしれない。

ポケモンWikiの攻略本の最終版 `experiments/poke-exp-20251113-3/books/100.txt`
> 特に「(GO)」「(アニメ)」「(カードゲーム)」などの付記は、ゴールページの種類や関連性を特定する上で重要となる。
ポケモンWiki特有の記法を考慮したテクニックが出力されていることが見て取れる。攻略本自動生成の面白いところは、人間がほとんどプレイしたことのないルールでもAIの試行錯誤によってテクニックが導かれ、それが言葉で説明されること。

## まとめと今後の課題

攻略本自動生成を目指し、WikipediaゴルフのテクニックをLLMを用いて導くことを試みた。
LLMを用いてゲームをプレイする環境を構築し、攻略本を改善させるサイクルを実現した。実験を通じて、Wikipediaでのプレイだけでなく、ポケモンWikiやWikitravelでも提案システムが有効に動作することが確認できた。
性能の上昇幅は比較的小さかった。攻略本の長さ制限が短すぎて、極めて一般的なことしか言えないかもしれない。
LLMの呼び出しコストの面で様々な制約が生じた。コストを抑えつつより有力な攻略本を生成する技術を今後も検討したい。
